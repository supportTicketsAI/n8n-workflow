{
  "name": "AI-Powered Support Co-Pilot - VIVETORI",
  "nodes": [
    {
      "parameters": {
        "path": "5ec1e629-d6db-4290-a81d-61a71b3b7883",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        180,
        300
      ],
      "id": "6c9fead2-6ac3-418b-9fe8-b6da1a5e9a3e",
      "name": "ğŸ¯ Webhook - Ticket Procesado",
      "webhookId": "5ec1e629-d6db-4290-a81d-61a71b3b7883"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "8a08b6cd-bd23-4a25-a1f5-8b7b7d72c144",
              "leftValue": "={{ $json.sentiment }}",
              "rightValue": "Negativo",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        500,
        300
      ],
      "id": "7d4a8b2e-3c5f-4e21-9b12-8f6e7a9c2d1b",
      "name": "ğŸ¤” Â¿Sentimiento Negativo?"
    },
    {
      "parameters": {
        "to": "support@vivetori.com",
        "subject": "ğŸš¨ ALERTA: Ticket con Sentimiento Negativo - {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.ticket_id }}",
        "message": "=ğŸš¨ **ALERTA DE SOPORTE URGENTE**\n\nğŸ“‹ **Ticket ID:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.ticket_id }}\nğŸ“‚ **CategorÃ­a:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.category }}\nğŸ˜  **Sentimiento:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.sentiment }}\nğŸ¯ **Confianza IA:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.confidence }}%\nâ±ï¸ **Tiempo de Procesamiento:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.processing_time }}\n\nğŸ“ **DescripciÃ³n del Ticket:**\n{{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.description }}\n\nğŸ”— **AcciÃ³n Requerida:**\nEste ticket requiere atenciÃ³n inmediata debido al sentimiento negativo detectado por nuestro sistema de IA.\n\n---\nğŸ¤– Generado automÃ¡ticamente por AI-Powered Support Co-Pilot\nğŸ’» Dashboard: http://localhost:5173/dashboard",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [
        820,
        180
      ],
      "id": "9a1b2c3d-4e5f-6789-abcd-ef1234567890",
      "name": "ğŸ“§ Enviar Email de Alerta"
    },
    {
      "parameters": {
        "url": "https://hooks.slack.com/workflows/REPLACE-WITH-YOUR-SLACK-WEBHOOK",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"text\": \"ğŸš¨ Ticket con Sentimiento Negativo Detectado\",\n  \"blocks\": [\n    {\n      \"type\": \"header\",\n      \"text\": {\n        \"type\": \"plain_text\",\n        \"text\": \"ğŸš¨ ALERTA: Ticket Negativo\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"fields\": [\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*Ticket ID:*\\n{{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.ticket_id }}\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*CategorÃ­a:*\\n{{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.category }}\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*Sentimiento:*\\nğŸ˜  {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.sentiment }}\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*Confianza IA:*\\n{{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.confidence }}%\"\n        }\n      ]\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*DescripciÃ³n:*\\n{{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.description }}\"\n      }\n    },\n    {\n      \"type\": \"actions\",\n      \"elements\": [\n        {\n          \"type\": \"button\",\n          \"text\": {\n            \"type\": \"plain_text\",\n            \"text\": \"Ver Dashboard\"\n          },\n          \"url\": \"http://localhost:5173/dashboard\",\n          \"action_id\": \"view_dashboard\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        820,
        300
      ],
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567891",
      "name": "ğŸ’¬ Notificar Slack (Opcional)"
    },
    {
      "parameters": {
        "url": "https://api.telegram.org/botYOUR_BOT_TOKEN/sendMessage",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"chat_id\": \"YOUR_CHAT_ID\",\n  \"text\": \"ğŸš¨ *ALERTA DE SOPORTE VIVETORI*\\n\\nğŸ“‹ *Ticket:* {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.ticket_id }}\\nğŸ“‚ *CategorÃ­a:* {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.category }}\\nğŸ˜  *Sentimiento:* {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.sentiment }}\\nğŸ¯ *Confianza:* {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.confidence }}%\\n\\nğŸ“ *DescripciÃ³n:*\\n{{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.description }}\\n\\nğŸ”— [Ver Dashboard](http://localhost:5173/dashboard)\",\n  \"parse_mode\": \"Markdown\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        820,
        420
      ],
      "id": "b2c3d4e5-f6g7-h890-ijkl-mn1234567892",
      "name": "ğŸ“± Notificar Telegram (Opcional)"
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "ticket_logs",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ticket_id": "={{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.ticket_id }}",
            "action": "notification_sent",
            "details": "=NotificaciÃ³n enviada por sentimiento negativo. CategorÃ­a: {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.category }}, Confianza: {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.confidence }}%",
            "created_at": "={{ new Date().toISOString() }}",
            "processing_time": "={{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.processing_time }}"
          },
          "matchingColumns": [],
          "schema": []
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1140,
        300
      ],
      "id": "c3d4e5f6-g7h8-i901-jklm-no1234567893",
      "name": "ğŸ“Š Log en Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "YOUR_SUPABASE_CREDENTIAL_ID",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "status",
              "value": "neutral_or_positive"
            },
            {
              "name": "action",
              "value": "no_notification_needed"
            },
            {
              "name": "message",
              "value": "=Ticket procesado exitosamente. CategorÃ­a: {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.category }}, Sentimiento: {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.sentiment }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        820,
        540
      ],
      "id": "d4e5f6g7-h8i9-j012-klmn-op1234567894",
      "name": "âœ… Ticket OK - Sin Alerta"
    },
    {
      "parameters": {
        "message": "=ğŸ‰ **TICKET PROCESADO EXITOSAMENTE**\\n\\nğŸ“‹ **ID:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.ticket_id }}\\nğŸ“‚ **CategorÃ­a:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.category }}\\nğŸ˜Š **Sentimiento:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.sentiment }}\\nğŸ¯ **Confianza:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.confidence }}%\\nâ±ï¸ **Tiempo:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.processing_time }}\\n\\nğŸ“ **DescripciÃ³n:** {{ $('ğŸ¯ Webhook - Ticket Procesado').item.json.description }}\\n\\nâœ… **Estado:** Procesado automÃ¡ticamente, no requiere acciÃ³n inmediata.\\n\\n---\\nğŸ¤– AI-Powered Support Co-Pilot - VIVETORI"
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        1140,
        540
      ],
      "id": "e5f6g7h8-i9j0-k123-lmno-pq1234567895",
      "name": "ğŸ® Log Discord (Opcional)",
      "credentials": {
        "discordWebhookApi": {
          "id": "YOUR_DISCORD_WEBHOOK_ID",
          "name": "Discord Webhook"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "ğŸ¯ Webhook - Ticket Procesado": {
      "main": [
        [
          {
            "node": "ğŸ¤” Â¿Sentimiento Negativo?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤” Â¿Sentimiento Negativo?": {
      "main": [
        [
          {
            "node": "ğŸ“§ Enviar Email de Alerta",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ’¬ Notificar Slack (Opcional)",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“± Notificar Telegram (Opcional)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âœ… Ticket OK - Sin Alerta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“§ Enviar Email de Alerta": {
      "main": [
        [
          {
            "node": "ğŸ“Š Log en Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¬ Notificar Slack (Opcional)": {
      "main": [
        [
          {
            "node": "ğŸ“Š Log en Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Notificar Telegram (Opcional)": {
      "main": [
        [
          {
            "node": "ğŸ“Š Log en Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœ… Ticket OK - Sin Alerta": {
      "main": [
        [
          {
            "node": "ğŸ® Log Discord (Opcional)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "efb90904-2266-4ee7-83b8-51e37ad591a1",
  "meta": {
    "instanceId": "9d961b1c216757284a81efc31ce8a1b8ef4550e9a68b24ef839bb7bc677bc223"
  },
  "id": "4phlQ2DIketIh13QKP_2D",
  "tags": [
    {
      "createdAt": "2026-01-22T23:45:00.000Z",
      "updatedAt": "2026-01-22T23:45:00.000Z",
      "id": "vivetori-ai-support",
      "name": "VIVETORI AI Support"
    }
  ]
}